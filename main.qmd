---
title: LIS 461 In Class Examples
author: Mariah A. Knowles
format:
  html:
    code-fold: true
jupyter: julia-1.8
---

# Install Packages

```{julia}
using Pkg
Pkg.add("CSV")
Pkg.add("DataFrames")
Pkg.add("Plots")
Pkg.add(url="https://github.com/snotskie/EpistemicNetworkAnalysis.jl")
```

# Load Packages

```{julia}
using CSV
using DataFrames
using Plots
using EpistemicNetworkAnalysis
```

# Load Data

```{julia}
data = DataFrame(CSV.File("data.tsv"))
for col in names(data)
    data[!, col] = replace(data[!, col], missing => 0)
end
```

# Bar Chart

```{julia}
good_feedback = [
    :GOOD_ASPECTS,
    :GOOD_CHASE,
    :GOOD_FLOW,
    :GOOD_TOP_DETAIL,
    :GOOD_VARIETY,
]

constructive_feedback = [
    :CITATIONS,
    :BURIED_CLAIM,
    :UNCLEAR_STRATEGY,
    :SPECIFIC_CASE,
    :MORAL_PREMISE,
    :WASHY,
    :MIXED_THEORY,
    :THINKING,
    :HEDGE,
    :PASSIVE,
    :DOES_NOT_FOLLOW,
    :HISTORY,
    :ADJ,
    :COMPLEX,
    :JARGON,
    :NOSE,
    :PAREN_RHET_Q,
    :PRONOUNS,
    :SHOULD,
    :SNARK,
    :TIMING,
    :WALL,
    :EXAMPLES,
    :REDUNDANT,
    :SUMMARIZE,
    :DAMAGE,
    :DISTILL,
    :MORELESS,
    :PREMISE_CLAIM,
    :STRAWMAN
]

all_feedback = vcat(good_feedback, constructive_feedback)

plot(string.(all_feedback),
    [sum(data[!, code]) for code in all_feedback],
    seriestype=:bar,
    rotation=-90,
    xticks=:all,
    legend=nothing)
```

# Feedback Selection

```{julia}
feedback_sums = reverse(
    sort(
        stack(
            combine(data, [f => sum => f for f in constructive_feedback]...), 1:30
        ),
        :value
    )
)

print(feedback_sums)
common_feedback = Symbol.(feedback_sums[1:10, :variable])
plot(string.(common_feedback),
    [sum(data[!, code]) for code in common_feedback],
    seriestype=:bar,
    rotation=-90,
    xticks=:all,
    legend=nothing)
```

# Model Options

```{julia}
biplot_only = (i, j, ci, cj) -> i == j
most_variance = SVDRotation()
grader_differences = MulticlassRotation(:Grader)
more_grader_differences = MulticlassRotation(:Grader, 1, 3)
first_vs_second = MeansRotation(:Assignment, "Workshop 1", "Workshop 2")
connected_assignments = [:RandomID]
separate_assignments = [:RandomID, :Assignment]
```

# Plots

## What kind of feedback are students individually receiving across their workshops?

```{julia}
ena = ENAModel(
    data, common_feedback, connected_assignments, connected_assignments,
    dropEmpty=true,
    rotateBy=most_variance
)

plot(ena)
```

## How did feedback on the first workshop compare to the second, on average?

```{julia}
ena = ENAModel(
    data, common_feedback, separate_assignments, separate_assignments,
    dropEmpty=true,
    relationshipFilter=biplot_only,
    rotateBy=first_vs_second
)

plot(ena)
```

## How did feedback given by different graders compare, on average?

```{julia}
ena = ENAModel(
    data, common_feedback, separate_assignments, separate_assignments,
    dropEmpty=true,
    relationshipFilter=biplot_only,
    rotateBy=grader_differences
)

plot(ena)
```

```{julia}
ena = ENAModel(
    data, common_feedback, separate_assignments, separate_assignments,
    dropEmpty=true,
    relationshipFilter=biplot_only,
    rotateBy=more_grader_differences
)

plot(ena)
```